import{G as C,b as N,r as x,j as e,A as _,B as O,C as F,z as S,e as p,E as b,D as g,c as w,H as D,a as E}from"./index-0Ts42cdv.js";import{N as B}from"./Nav-BVKnZJNI.js";function $(a){return C({tag:"svg",attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"rect",attr:{x:"7",y:"4",fill:"#BBDEFB",width:"34",height:"40"},child:[]},{tag:"g",attr:{fill:"#2196F3"},child:[{tag:"rect",attr:{x:"13",y:"26",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"18",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"34",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"10",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"26",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"18",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"34",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"10",width:"14",height:"4"},child:[]}]}]})(a)}function v({orders:a,delivery_status_id:r,setOpenModal:d,setSelectedOrderId:n,setSelectedOrderAction:h}){const j=N(),[l,u]=x.useState("idle"),[s,i]=x.useState({}),c=(t,y)=>{u(m=>"pending"),p.get(`${b.orderDetails}/${t.id}`).then(m=>{p.put(`${b.changeOrderStatus}`,{order_id:t.id,status_id:y,userDetails:{name:t.title,phone:t.alternative_phone_number,address:t.delivery_address,price:t.price,email:t.email},orderDetails:m.data}).then(f=>{j(g()),u(k=>"fulfilled"),i({})}).catch(f=>{console.log(f.message),u(k=>"rejected"),i(f)})}).catch(m=>{console.log(m)})},o=t=>{if(window.confirm("Вы действительно хотите удалить товар?"))p.delete(`${b.getUserOrders}/${t}`).then(m=>{j(g())}).catch(m=>{console.log(m.message),j(g())});else return};return e.jsxs("table",{className:"admin-order-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"admin-order-table-header-row",children:[e.jsx("th",{children:"Номер заказа"}),e.jsx("th",{children:"На имя"}),e.jsx("th",{children:"Адресс"}),e.jsx("th",{children:"Телефон"}),e.jsx("th",{children:"Итого"}),e.jsx("th",{children:"Время заказа"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:a&&a.map(t=>{let y=t.created_at.replace("T"," ").replace(".000Z","");return t.id,t.delivery_status===r&&e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:t.title}),e.jsx("td",{children:t.delivery_address}),e.jsx("td",{children:t.alternative_phone_number}),e.jsx("td",{children:t.price}),e.jsx("td",{children:String(y)}),e.jsxs("td",{children:[e.jsx("button",{className:"icon-button",style:{borderRadius:10,padding:"5px 5px 0"},title:r===1?"Принять заказ":"Изменить статус",disabled:l==="pending",onClick:()=>{c(t,r)},children:r===1?e.jsx(_,{}):e.jsx(O,{})}),e.jsx("button",{className:"icon-button",style:{borderRadius:10,padding:"5px 5px 0"},title:"Детали заказа",disabled:l==="pending",onClick:()=>{d(!0),n(t.id),h("order-details")},children:e.jsx($,{})}),e.jsx("button",{className:"icon-button",style:{borderRadius:10,padding:"5px 5px 0"},title:"Изменить",disabled:l==="pending",onClick:()=>{d(!0),n(t.id),h("edit-order")},children:e.jsx(F,{})}),e.jsx("button",{className:"icon-button",style:{borderRadius:10,padding:"5px 5px 0"},title:"Удалить заказ",disabled:l==="pending",onClick:()=>o(t.id),children:e.jsx(S,{style:{color:"#801634"}})})]})]},t.id)})})]})}function A({orderId:a}){N();const{orderDetails:r}=w(d=>d.admin);return e.jsxs("div",{className:"admin-order-details",children:[e.jsxs("h5",{style:{marginBottom:10,marginTop:5},children:["Номер заказа: #",a]}),e.jsxs("table",{className:"admin-order-table",style:{width:750,minWidth:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"admin-order-table-header-row",children:[e.jsx("th",{children:"Идентификатор"}),e.jsx("th",{children:"Наименование Продукта"}),e.jsx("th",{children:"Цена"}),e.jsx("th",{children:"Количество"})]})}),e.jsx("tbody",{children:r.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:d.id}),e.jsx("td",{children:d.title}),e.jsx("td",{children:d.price}),e.jsx("td",{children:d.quantity})]},d.id))})]})]})}function I({orderId:a}){const r=N(),{orderDetails:d}=w(s=>s.admin),[n,h]=x.useState([]);x.useEffect(()=>{console.log(d),h(d)},[d]);const j=(s,i)=>{const c=n.map(o=>o.id===i.id?{...o,quantity:parseInt(s)}:o);h(c)},l=s=>{console.log("deleting ",s),p.delete(`${b.orderDetails}/${s.id}`,{data:{order_id:s.order_id}}).then(i=>{console.log("deleted item"),r(D(a)),r(g())}).catch(i=>{console.log(i)})},u=s=>{const i=n.find(c=>c.id===s);console.log(i),p.put(`${b.orderDetails}`,{id:i.id,order_id:Number(i.order_id),quantity:i.quantity}).then(c=>{r(D(a)),r(g())}).catch(c=>{console.log(c)})};return e.jsx("div",{children:e.jsxs("div",{className:"admin-order-details",children:[e.jsxs("h5",{style:{marginBottom:10,marginTop:5},children:["Номер заказа: #",a]}),e.jsxs("table",{className:"admin-order-table",style:{width:750,minWidth:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"admin-order-table-header-row",children:[e.jsx("th",{children:"Ид."}),e.jsx("th",{children:"Наименование"}),e.jsx("th",{children:"Цена"}),e.jsx("th",{children:"Кол-вo"}),e.jsx("th",{children:"Действие"})]})}),e.jsx("tbody",{children:n&&n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.title}),e.jsx("td",{children:s.price}),e.jsx("td",{children:e.jsx("input",{type:"text",style:{textAlign:"right"},value:s.quantity,onChange:i=>j(i.target.value,s)})}),e.jsxs("td",{children:[e.jsx("button",{className:"icon-button",onClick:()=>u(s.id),children:e.jsx(_,{})}),e.jsx("button",{className:"icon-button",style:{borderRadius:10,padding:"5px 5px 0"},title:"Удалить заказ",onClick:()=>l(s),children:e.jsx(S,{style:{color:"#801634"}})})]})]},s.id))})]}),e.jsx("div",{className:"df jcsb",children:e.jsx("span",{})})]})})}function T({title:a,setOpenModal:r}){return e.jsx(e.Fragment,{})}function q(){const a=E(),[r,d]=x.useState(!1),[n,h]=x.useState("new"),[j,l]=x.useState(""),[u,s]=x.useState(null),i=["new","cooking","delivering","delivered"],c=N(),{orders:o}=w(t=>t.admin);return x.useEffect(()=>{localStorage.getItem("admin")||a("/admin"),c(g()),setInterval(()=>{c(g())},3e4)},[]),e.jsxs("div",{className:"admin-dashboard",children:[e.jsx(B,{}),e.jsxs("div",{className:"admin-dashboard-content",children:[e.jsxs("div",{className:"order-status-navigation",children:[e.jsx("button",{className:"primary-button small-btn",onClick:()=>h(i[0]),disabled:n===i[0],children:"Новые"}),e.jsx("button",{className:"primary-button small-btn",onClick:()=>h(i[1]),disabled:n===i[1],children:"Готовиться"}),e.jsx("button",{className:"primary-button small-btn",onClick:()=>h(i[2]),disabled:n===i[2],children:"В Пути"}),e.jsx("button",{className:"primary-button small-btn",onClick:()=>h(i[3]),disabled:n===i[3],children:"Доставлено"})]}),n==="new"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Новые"}),e.jsx("div",{children:e.jsx(v,{orders:o,delivery_status_id:1,setOpenModal:d,setSelectedOrderId:l,setSelectedOrderAction:s})})]}),n==="cooking"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Готовиться"}),e.jsx("div",{children:e.jsx(v,{orders:o,delivery_status_id:2,setOpenModal:d,setSelectedOrderId:l,setSelectedOrderAction:s})})]}),n==="delivering"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"В Пути"}),e.jsx("div",{children:e.jsx(v,{orders:o,delivery_status_id:3,setOpenModal:d,setSelectedOrderId:l,setSelectedOrderAction:s})})]}),n==="delivered"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Доставлено"}),e.jsx("div",{children:e.jsx(v,{orders:o,delivery_status_id:4,setOpenModal:d,setSelectedOrderId:l,setSelectedOrderAction:s})})]}),r&&e.jsx(T,{title:u==="order-details"?"Детали заказа":"Изменить Заказ",setOpenModal:d,children:u==="order-details"?e.jsx(A,{orderId:j}):e.jsx(I,{orderId:j})})]})]})}export{q as default};
